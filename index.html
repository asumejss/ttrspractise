<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Times Tables Trainer</title>
  <style>
    body {
      background: #222;
      color: white;
      font-family: Arial;
      text-align: center;
      padding: 20px;
    }
    .hidden { display: none; }
    button, input {
      padding: 10px;
      margin: 5px;
      font-size: 1rem;
    }
  </style>
</head>
<body>

  <h1>Times Tables Trainer</h1>

  <!-- Auth Section -->
  <div id="authSection">
    <input type="email" id="email" placeholder="Email" /><br>
    <input type="password" id="password" placeholder="Password" /><br>
    <button id="signupBtn">Sign Up</button>
    <button id="loginBtn">Log In</button>
  </div>

  <!-- Game Section -->
  <div id="gameSection" class="hidden">
    <div id="welcomeUser"></div>
    <div id="question">Press Start</div>
    <div id="options"></div>
    <div id="score">Score: 0</div>
    <button id="startBtn">Start Game</button>
    <button id="logoutBtn">Log Out</button>
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- Firebase Config -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBbBRiSBMX-QOe-WXI-BDaKE5nFkr6r4UU",
      authDomain: "timestablestrainer-3ccf8.firebaseapp.com",
      projectId: "timestablestrainer-3ccf8",
      storageBucket: "timestablestrainer-3ccf8.firebasestorage.app",
      messagingSenderId: "129355540273",
      appId: "1:129355540273:web:be917252eb94bfa938b210",
      measurementId: "G-8RWC8J46ZB"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
  </script>

  <!-- Game Logic -->
  <script>
    const authSection = document.getElementById('authSection');
    const gameSection = document.getElementById('gameSection');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const signupBtn = document.getElementById('signupBtn');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const welcomeUser = document.getElementById('welcomeUser');

    let currentUser = null;

    signupBtn.onclick = () => {
      auth.createUserWithEmailAndPassword(email.value, password.value)
        .then(user => alert("Signed up!"))
        .catch(err => alert(err.message));
    };

    loginBtn.onclick = () => {
      auth.signInWithEmailAndPassword(email.value, password.value)
        .then(user => {
          currentUser = user.user;
          showGame();
        })
        .catch(err => alert(err.message));
    };

    logoutBtn.onclick = () => {
      auth.signOut().then(() => {
        currentUser = null;
        gameSection.classList.add('hidden');
        authSection.classList.remove('hidden');
      });
    };

    function showGame() {
      authSection.classList.add('hidden');
      gameSection.classList.remove('hidden');
      welcomeUser.textContent = `Welcome, ${currentUser.email}`;
    }

    // Game Logic
    const startBtn = document.getElementById('startBtn');
    const question = document.getElementById('question');
    const options = document.getElementById('options');
    const scoreEl = document.getElementById('score');

    let score = 0;
    let currentAnswer = 0;

    function generateQuestion() {
      const a = Math.floor(Math.random() * 12) + 1;
      const b = Math.floor(Math.random() * 12) + 1;
      currentAnswer = a * b;
      question.textContent = `${a} Ã— ${b} = ?`;

      options.innerHTML = '';
      const correctIndex = Math.floor(Math.random() * 4);
      for (let i = 0; i < 4; i++) {
        const btn = document.createElement('button');
        btn.textContent = i === correctIndex ? currentAnswer : (currentAnswer + Math.floor(Math.random() * 10 + 1));
        btn.onclick = () => checkAnswer(parseInt(btn.textContent));
        options.appendChild(btn);
      }
    }

    function checkAnswer(value) {
      if (value === currentAnswer) {
        score++;
        scoreEl.textContent = `Score: ${score}`;
        generateQuestion();
      } else {
        endGame();
      }
    }

    function endGame() {
      question.textContent = "Game Over!";
      options.innerHTML = '';
      db.collection("scores").doc(currentUser.uid).set({
        email: currentUser.email,
        score: score,
        timestamp: Date.now()
      });
    }

    startBtn.onclick = () => {
      score = 0;
      scoreEl.textContent = `Score: 0`;
      generateQuestion();
    };

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        showGame();
      }
    });
  </script>
</body>
</html>
